<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>NVDLA阅读笔记 | 大卫的博客园</title><meta name="keywords" content="NVDLA"><meta name="author" content="DavidGu"><meta name="copyright" content="DavidGu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="referrer" content="no-referrer"><meta name="description" content="关于我实习学习NVDLA的一些记录">
<meta property="og:type" content="article">
<meta property="og:title" content="NVDLA阅读笔记">
<meta property="og:url" content="http://david-luge.cn/2022/09/29/Proj/NVDLA%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="大卫的博客园">
<meta property="og:description" content="关于我实习学习NVDLA的一些记录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://david-luge.cn/img/Page_Cover/NVIDIA_cover.png">
<meta property="article:published_time" content="2022-09-29T02:04:39.000Z">
<meta property="article:modified_time" content="2022-09-29T02:04:39.000Z">
<meta property="article:author" content="DavidGu">
<meta property="article:tag" content="Proj">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://david-luge.cn/img/Page_Cover/NVIDIA_cover.png"><link rel="shortcut icon" href="//common.cnblogs.com/favicon.svg"><link rel="canonical" href="http://david-luge.cn/2022/09/29/Proj/NVDLA%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: DavidGu","link":"链接: ","source":"来源: 大卫的博客园","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'NVDLA阅读笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-09-29 10:04:39'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/background.css"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/icon.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="大卫的博客园" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/HomePage/avatar.jpg" onerror="onerror=null;src='/img/HomePage/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">57</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/statistics/"><i class="fa-fw fa-fw fas fa-chart-line"></i><span> 统计</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-heartbeat"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tools/"><i class="fa-fw fas fa-tools"></i><span> 百宝箱</span></a></li><li><a class="site-page child" href="/chats/"><i class="fa-fw fas fa-comment-dots"></i><span> 碎碎念</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/Page_Cover/NVIDIA_cover.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">大卫的博客园</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/statistics/"><i class="fa-fw fa-fw fas fa-chart-line"></i><span> 统计</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-heartbeat"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tools/"><i class="fa-fw fas fa-tools"></i><span> 百宝箱</span></a></li><li><a class="site-page child" href="/chats/"><i class="fa-fw fas fa-comment-dots"></i><span> 碎碎念</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">NVDLA阅读笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-09-29T02:04:39.000Z" title="发表于 2022-09-29 10:04:39">2022-09-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-09-29T02:04:39.000Z" title="更新于 2022-09-29 10:04:39">2022-09-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Proj/">Proj</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>16分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="NVDLA阅读笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="NVDLA阅读笔记"><a href="#NVDLA阅读笔记" class="headerlink" title="NVDLA阅读笔记"></a>NVDLA阅读笔记</h1><h2 id="Unit-Description"><a href="#Unit-Description" class="headerlink" title="Unit Description"></a>Unit Description</h2><h3 id="System-Architecture"><a href="#System-Architecture" class="headerlink" title="System Architecture"></a>System Architecture</h3><p>NVDLA作为深度学习加速器可以集成在SoC中作为一个协处理器；</p>
<p>NVDLA有许多数据处理Engine，各Engine都是独立的且可以自由配置，比如不需要池化的网络可以移除Planar Data Processor，各Engine的调度操作可以委托给Microcontroller或者CPU；其中用Microcontroller来调度的方式称为“headed” implementation，用CPU来调度的方式称为“headless” implementation；</p>
<p>图中左边的框图展示了“headless” implementation的示例，是一个小型的NVDLA系统，成本较低；右边的框图展示了“headed” implementation的示例，是一个大型的NVDLA系统，主要是添加了Microcontroller和高带宽的SRAM，适合于高性能的物联网设备。</p>
<p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232141331.png" alt="1"></p>
<p>NVDLA主要有4个接口，其中SRAMIF是可选项；</p>
<ul>
<li>CSB（Configuration Space Bus）：这个接口是一个同步、低带宽、低功耗的32位控制总线，主要用来访问NVDLA的配置寄存器；</li>
<li>IRQ（Interrupt Request）：当NVDLA中的任务完成或者发生错误时会将中断线进行置位；</li>
<li>DBB（Data Backbone Interface）：DBB接口连接NVDLA和片外的DRAM，与AXI接口类似，是高速、高度可配置的数据总线，可以根据系统的要求发出不同大小的读写请求；</li>
<li>SRAMIF（SRAM Interface）：DBB接口还有一个可选的接口，在设计上与DBB接口相同，目的在于结合片上的SRAM来提供更高的数据吞吐量以及更低的访问延迟；</li>
</ul>
<h3 id="DLA-Core-Architecture"><a href="#DLA-Core-Architecture" class="headerlink" title="DLA Core Architecture"></a>DLA Core Architecture</h3><p>DLA的结构框图如图所示；内部主要有两个接口模块，其中Configuration Interface用于访问NVDLA的配置寄存器，Memory Interface用于读写特征数据、权重、像素数据等；</p>
<p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232141690.png" alt="2"></p>
<p>Convolution buffer主要用于缓存像素数据、特征数据、权重数据等，供卷积核中的卷积序列控制器模块读取；Convolution core主要完成卷积中的乘加运算；SDP主要负责对单个数据执行后处理操作，包括bias加法、ReLU、Sigmoid、双曲正切、BN、逐元素操作等；PDP是平面数据处理器，主要完成池化相关的操作；CDP主要在通道方向上执行操作，旨在解决局部响应归一化层；RUBIK模块的功能与BDMA类似，它在不进行任何数据计算的情况下转换数据的映射格式，因为它的功能是变换特征数据立方体的尺寸，所以又被称为魔方单元；BDMA模块在外部DRAM和片上SRAM之间提供了一条移动数据的通道，它有两条独立的路径，一条是将数据从外部DRAM复制&#x2F;移动到内部SRAM，另一条是将数据从内部SRAM复制&#x2F;移动到外部DRAM，两条路径不能同时工作；</p>
<p>NVDLA有两种工作模式，独立模式（Independent Mode）和结合模式（Fused Mode）。独立模式下，各Engine分别通过两组数据接口完成各自分配的任务；结合模式可以将Convolution Core、SDP和PDP连接在一起作为一个整体流水线完成分配的任务；</p>
<h3 id="Convolution-Pipeline"><a href="#Convolution-Pipeline" class="headerlink" title="Convolution Pipeline"></a>Convolution Pipeline</h3><p>流水线卷积模块是NVDLA的核心逻辑，用于加速卷积算法，同时在卷积流水线中引入了Winograd算法和Multi-batch，提高MAC效率。Convolution Pipeline有五个阶段，分别是Convolution DMA、Convolution Buffer、Convolution Sequence Controller、Convolution MAC和Convolution Accumulator，各阶段都有自己的CSB来接收来自CPU的配置数据。CDMA从SRAM&#x2F;DRAM中获取数据来进行卷积操作，并按卷积Engine所需的数据顺序存储到CBUF中；CBUF缓存来自CDMA模块的像素、特征和权重等数据，由CSC模块进行读取；CSC模块负责从CBUF加载数据并发送到CMAC单元，它是卷积序列控制的关键模块；CMAC模块从CSC接收输入数据和权重，执行乘法和加法运算，并将结果输出给CACC；CACC模块用于对CMAC模块的部分和进行累加，并在发送给SDP模块前对数据进行舍入操作。</p>
<p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232141311.png" alt="3"></p>
<h3 id="CDMA"><a href="#CDMA" class="headerlink" title="CDMA"></a>CDMA</h3><p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232141023.png" alt="4"></p>
<p>CDMA主要负责从SRAM&#x2F;DRAM中获取数据来进行卷积操作，读取的数据主要有以下数据类型：</p>
<ul>
<li>像素数据（Pixel Data）</li>
<li>特征数据（Feature Data）</li>
<li>未压缩&#x2F;压缩权重数据（Uncompressed&#x2F;compressed weight）</li>
<li>WMB（Weight Mask Bit）</li>
<li>WGS（Weight Group Size）</li>
</ul>
<p>CDMA主要有两个数据通道，分别是权重读取通道和数据读取通道，CDMA仅发送数据读取的请求。CDMA有三个子模块来获取像素数据或者特征数据来进行卷积，分别是CDMA_IMG（Pixel）、CDMA_WG（Winograd）、CDMA_DC（Direct Convolution）。上述三个子模块的工作步骤类似，区别在于数据存放在CBUF RAM中的格式，任何时候只能有一个子模块被激活来获取像素&#x2F;特征数据。以CDMA_DC为例介绍一下CDMA的工作流程：</p>
<ul>
<li>检查CBUF的状态，查看是否有空间；</li>
<li>进行一个读取事务；</li>
<li>在共享缓冲区（Shared_buffer）中缓存特征数据；</li>
<li>将特征数据立方体重塑为正确的格式；</li>
<li>生成卷积缓冲区（CBUF）的写入地址；</li>
<li>将特征数据写入CBUF；</li>
<li>更新CDMA_STATUS子模块中CBUF的状态；</li>
</ul>
<h3 id="CBUF"><a href="#CBUF" class="headerlink" title="CBUF"></a>CBUF</h3><p>CBUF模块有16个32KB的Bank，每个Bank由两个512位宽、256深度的双口RAM组成，存储空间共512KB；CBUF缓存来自CDMA的像素、特征、权重和WMB数据，并由CSC模块进行读取；CBUF有两个写端口和三个读端口。</p>
<p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232141424.png" alt="5"></p>
<p>如果权重被压缩，那么Bank15分配给WMB数据，Bank0~14分配给特征、权重进行缓存。如果权重没被压缩，那么特征、权重缓冲区可以使用16个Bank；</p>
<p>每个Bank都是循环缓冲区，新的数据进来时地址都会进行自增，当地址达到最大值后会回到0重新自加；</p>
<h3 id="CSC"><a href="#CSC" class="headerlink" title="CSC"></a>CSC</h3><p>卷积序列控制器（CSC）负责从CBUF加载输入特征数据、像素数据和权重数据，并将其发送到CMAC单元，主要包含三个模块：CSC_SG、CSC_WL和CSC_DL。</p>
<p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232142001.png" alt="6"></p>
<h4 id="CSC-SG"><a href="#CSC-SG" class="headerlink" title="CSC_SG"></a>CSC_SG</h4><p>CSC_SG模块用来生成序列来控制卷积操作，它的工作流程如下：</p>
<ol>
<li>在CBUF中轮询足够的数据和权重；</li>
<li>生成一对序列包，包括weight加载包和data加载包，每个包表示一个stripe operation；</li>
<li>将两个加载包push到两个FIFO中；</li>
<li>两个用于weight和feature&#x2F;image的计数器都是向下计数；&#x2F;&#x2F;计数器的作用？</li>
<li>当计数器达到零时，检查来自CACC的信号是否有任何back pressure；</li>
<li>如果所有条件都准备就绪，就将weight和data包发送给CSC_WL和CSC_DL；</li>
</ol>
<h4 id="CSC-DL"><a href="#CSC-DL" class="headerlink" title="CSC_DL"></a>CSC_DL</h4><p>CSC_DL（Data loader）负责执行feature&#x2F;image加载序列的逻辑，他从CSC_SG接收包，从CBUF加载feature&#x2F;image data，并将其发送到CMAC；且它还维护CBUF的状态，并与CDMA通信以保持状态最新。对于Winograd模式，它还执行预加法来转换输入数据；</p>
<p>以DC mode为例说明CSC_DL的工作流程：											</p>
<ol>
<li>每个Atomic Operation，DL从CBUF读取一个data atom，并发送给CMAC；</li>
<li>每个Stripe Operation，DL从CBUF读取16~32个data atom，并发送给CMAC；</li>
<li>每个Block Operation，DL重复（weight_height*weight_width）次stripe operation，从CBUF读取对应的data atom，并发送给CMAC；</li>
<li>每次Channel Operation，DL重复C&#x2F;64次block Operation，从CBUF读取对应的data atom，并发送给CMAC；</li>
<li>每个Group Operation，DL遍历整个feature map，重复（data_width*data_height）&#x2F;（16~32）次channel operation，并发送给CMAC；</li>
<li>DL重复kernel_num&#x2F;（16~32）次group operation，每次的data都是相同的；</li>
</ol>
<p>注：16 or 32取决于数据精度。</p>
<h4 id="CSC-WL"><a href="#CSC-WL" class="headerlink" title="CSC_WL"></a>CSC_WL</h4><p>CSC_WL（Weight loader）执行weight加载序列的逻辑，它从CSC_SG接收包，从CBUF加载weight，并进行必要的解压缩并将其发送到CMAC。它帮助维护权重缓冲区状态，并与CDMA_WT通信，来使状态及时更新。</p>
<p>以DC mode为例说明CSC_WL的工作流程：											</p>
<ol>
<li>每个atomic operation，WL不需要操作；</li>
<li>每个stripe operation，WL从CBUF读取1个group的16&#x2F;32个weight atom，并发送给CMAC；</li>
<li>每个block operation，WL重复（weight_height*weight_width）次stripe operation，从CBUF读取对应的weight atom，并发送给CMAC；</li>
<li>每个channel operation，WL重复C&#x2F;64次block operation，从CBUF读取对应的weight atom，并发送给CMAC；（tips：64&#x3D;128byte&#x2F;(int16&#x2F;fp16)）</li>
<li>每个group operation，WL反复读取同一组group的weight，重复（data_width*data_height）&#x2F;（16~32）次channel operation，并发送给CMAC；</li>
<li>WL重复kernel_num&#x2F;（16~32）次group operation，完成所有kernel group的读取；</li>
</ol>
<h3 id="CMAC"><a href="#CMAC" class="headerlink" title="CMAC"></a>CMAC</h3><p>CMAC（Convolution Multiply Accumulate）模块是流水线卷积操作的一个阶段，它从CSC接收输入数据和权重，进行乘法和加法运算，并将输出结果输出到卷积累加器。当在Winograd模式下工作时，CMAC在输出上执行POA(post addition)将结果转换为标准激活格式。</p>
<p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232142273.png" alt="7"></p>
<p>CMAC有16个相同的MAC Cell，每个MAC Cell包含64个用于16bit的16位乘法器，还包含72个16bit的加法器，用于Winograd的POA。每个16位宽的乘法器和加法器都可以拆分成int8格式的两个计算单元，所以int8的吞吐量是int16的两倍；MAC Cell的流水线深度为7个Cycle。</p>
<p>为了Physical Design Optimization，CMAC被分为两部分CMAC_A和CMAC_B，每个都有单独的CSB接口。</p>
<h3 id="CACC"><a href="#CACC" class="headerlink" title="CACC"></a>CACC</h3><p>卷积累加器（CACC）是卷积流水线在CMAC之后的阶段，它用于累加CMAC模块的部分和，并在发送到SDP之前对结果进行舍入&#x2F;饱和。它支持不同位宽的数据输入，对于INT16输入而言结果位宽为48位，对于INT8输入而言结果位宽为34位。CACC和SDP模块之间的数据位宽是32，所以在将结果发送给SDP之前需要执行一个舍入和饱和运算。</p>
<p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232142043.png" alt="8"></p>
<p>CACC中的组件如图所示，工作流程主要如下：</p>
<ol>
<li>从assembly SRAM中预取累加和；</li>
<li>当CMAC的部分和到达时，将它们与累加和一起发送到adder array；如果部分和来自第一个stripe operation，则累积和应为0；</li>
<li>从adder array的输出端收集新的累加和；</li>
<li>存储到assembly SRAM中；</li>
<li>在stripe operation中重复step1~step3，直到一个channel operation完成；</li>
<li>如果完成channel operation，加法器的输出将被舍入并饱和；</li>
<li>收集上一步的结果并将其存储到delivery SRAM中；</li>
<li>从delivery SRAM中加载结果并将它们发送给SDP；</li>
</ol>
<p>为支持Direct Convolution模式下的Multi-Batch选项，CACC在交付SRAM组中应用了data remapping功能；为了防止数据溢出，CACC使用相关协议来反压CSC模块。</p>
<h3 id="SDP"><a href="#SDP" class="headerlink" title="SDP"></a>SDP</h3><p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232142835.png" alt="9"></p>
<p>SDP是单点数据处理器，意在对单个数据元素级别执行后处理操作，主要完成以下的操作：</p>
<ol>
<li>**<u>Bias加法</u>**的公式为<code>y=x+bias</code>，bias是一个预先训练的参数，可以是以下3种之一：如果整个data cube都是同一bias的话可以从寄存器获取；per-channel模式下，同一channel内bias共享；per-element模式下，不同的element的bias都不同。</li>
<li>Non-Linear Function，包括ReLU、Sigmoid和双曲正切。ReLU可以通过硬件逻辑实现，Sigmoid和双曲正切函数是非线性函数，所以用查找表来实现；</li>
<li>Batch Normalization：SDP支持使用给定的均值&#x2F;标准方差参数进行批量归一化，参数是从训练中获得的，SDP还可以支持按层参数或者按通道参数进行批量归一化操作；</li>
<li>Element-Wise Layer：它指两个具有相同W、H和C参数的特征数据立方体之间的一种操作。这两个W×H×C特征数据立方体进行元素加法、乘法、或MAX&#x2F;MIN比较操作，并输出一个W×H×C的特征数据立方体；</li>
<li>PReLU Function，ReLU是将负值裁剪到0，而PReLU是将负值进行缩放；</li>
<li>Format Conversion：NVDLA支持INT8、INT16和FP16精度，较低的精度可提供较高的性能，而较高的精度可提供更好的推理结果。</li>
</ol>
<h3 id="PDP"><a href="#PDP" class="headerlink" title="PDP"></a>PDP</h3><p>PDP主要沿宽×高的平面执行操作，PDP模块旨在完成池化层，支持MAX、MIN和AVERAGE池化操作。PDP单元接收来自SDP或者MCIF&#x2F;SRAMIF的数据，并将数据发送给MCIF&#x2F;SRAMIF。</p>
<p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232142274.png" alt="10"></p>
<p>支持的尺寸如下：Pooling Kernel Size：1<del>8；Pooling Kernel Stride：1</del>16；</p>
<p>on-the-fly模式下输入数据直接从SDP获取，off-fly模式下输入数据从PDMA获取；</p>
<p>Pre-processing模块主要完成最大、最小操作以及部分和的求和操作；</p>
<p>Pos-processing模块主要针对Average Pooling进行相关的后处理操作，如果是MAX&#x2F;MIN Pooling操作的话，那么Share Line Buffer存储的就是最终结果；如果是Average Pooling的话，需要取出Share Line Buffer中的数进行除法操作，并且为方便硬件实现将除法转换为乘法操作；</p>
<h3 id="CDP"><a href="#CDP" class="headerlink" title="CDP"></a>CDP</h3><p>CDP模块旨在解决局部响应归一化层，LRN通过在通道方向上对局部输入区域进行归一化。CDP模块始终与其它处理子单元<u><strong>独立工作</strong></u>，它从PDMA接收输入数据并将输出数据发送回PDMA。</p>
<p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232142860.png" alt="11"></p>
<p>LRN的计算公式中涉及到除法和指数运算，使用硬件实现代价较大，所以内部用LUT实现功能。</p>
<h3 id="RUBIK"><a href="#RUBIK" class="headerlink" title="RUBIK"></a>RUBIK</h3><p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232143590.png" alt="12"></p>
<p>RUBIK的功能是转换数据的映射格式，主要有三种工作模式：</p>
<ul>
<li>contract data cube</li>
<li>split feature data cube into multi-planar formats</li>
<li>merge multi-planar formats to data cube</li>
</ul>
<h3 id="BDMA"><a href="#BDMA" class="headerlink" title="BDMA"></a>BDMA</h3><p>NVDLA一般将输入图像和处理结果存储在外部DRAM中，但受限于DRAM的带宽和延迟，NVDLA不能提高MAC阵列的效率，所以NVDLA配置了一个到片上SRAM的辅助存储器接口。</p>
<p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232143215.png" alt="13"></p>
<p>NVDLA使用BDMA来在外部DRAM和内部SRAM之间移动数据，有两个独立的路径，一个是从DRAM到SRAM，另一个是从SRAM到DRAM，两个方向不能同时工作。同时BDMA还可以将数据从DRAM移动到DRAM，或者从SRAM移动到SRAM。</p>
<p>两个接口的数据位宽均为512位，最大突发长度为4。</p>
<h3 id="MCIF-amp-SRAMIF"><a href="#MCIF-amp-SRAMIF" class="headerlink" title="MCIF&amp;SRAMIF"></a>MCIF&amp;SRAMIF</h3><p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232143502.png" alt="14"></p>
<p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232143212.png" alt="15"></p>
<p>MCIF用于仲裁多个内部子模块的请求，并转换为AXI协议来连接到外部DRAM。MCIF是同时支持读写通道的仲裁的，但有些NVDLA的子模块只有读请求，如图中的CDMA0和CDMA1只有读请求，其它5个接口均需要读写。</p>
<p>SRAMIF与MCIF接口功能类似，但预计总线延迟更低。</p>
<h2 id="Convolution-in-NVDLA"><a href="#Convolution-in-NVDLA" class="headerlink" title="Convolution in NVDLA"></a>Convolution in NVDLA</h2><p>下面简单说一下NVDLA中直接卷积的流程。输入的Data Cube为W×H×C；共K个kernel，每个kernel的尺寸为S×R×C；输出的Data Cube尺寸为W’×H’×C’；其中W’和H’与Padding和Stride有关，C’与Kernel数量相等；</p>
<p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232143782.png" alt="16"></p>
<p>下图显示了Stride和Zero Padding的示意图，其中黑色虚线框出的是Padding之前的Feature Data；Kernel字母表示卷积核的中间位置，可以看到在X方向和Y方向上分别以SX和SY为距离进行步进；</p>
<p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232143564.png" alt="17"></p>
<h3 id="Data-Format"><a href="#Data-Format" class="headerlink" title="Data Format"></a>Data Format</h3><p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232143069.png" alt="18"></p>
<p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232144717.png" alt="19"></p>
<p>这张图显示了Direct Convolution模式下特征数据与权重的数据格式，特征数据以32Byte为单位，在W-H-C方向上进行扫描并对数据进行存储，如果原始特征数据不是C方向上的32字节对齐，则将数据添加到通道末尾；</p>
<p>权重数据是在卷积操作之前很久就生成的，软件应将权重数据按DLA中的计算顺序进行映射。权重是在通道方向上以128Byte为单位进行划分，不足128Byte的话要进行一个补零操作，在C’-W-H-C方向上进行扫描并对数据进行存储。</p>
<h3 id="Atomic-Operation"><a href="#Atomic-Operation" class="headerlink" title="Atomic Operation"></a>Atomic Operation</h3><p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232144637.png" alt="20"></p>
<p>在一个原子操作中，每个MAC Cell都取一个1×1×64的weight cube（16bit）来与1×1×64的feature data做运算，**<u>完成64个数的乘加运算操作（64个Channel）</u><strong>。因为有16个MAC Cell，所以一次能并行计算16个kernel，MAC Cell乘加运算后的结果叫做部分和，所以</strong><u>每个Cycle我们可以得到16个部分和（partial sum）</u>**。得到的部分和被送往CACC模块进行累积和的计算。</p>
<h3 id="Stripe-Operation"><a href="#Stripe-Operation" class="headerlink" title="Stripe Operation"></a>Stripe Operation</h3><p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232144640.png" alt="21"></p>
<p>条带操作是原子操作的组合，在一次条带操作的过程中，**<u>MAC Cell中的权重数据保持不变</u>**，特征数据沿着input data cube滑动。（首先沿着W方向进行滑动）</p>
<p>由于条带操作MAC Cell中权重数据保持不变，所以**<u>一次条带操作中的部分和不能进行累加操作</u>**，因为它们来自不同的卷积核；这就是说需要在CACC模块对部分和进行缓存。</p>
<p><strong><u>由于CACC模块的缓冲区受限，所以Stripe Operation的Length有上限，上限为32。</u><strong>同时Stripe Operation的Length也有下限，</strong><u>因为要更新下一次Stripe Operation的权重数据至少要16个Cycle，所以下限为16。</u></strong></p>
<p>即1次Stripe Operation&#x3D;16~32次Atomic Operation，其中Weight Data不变，滑动Feature Data。</p>
<h3 id="Block-Operation"><a href="#Block-Operation" class="headerlink" title="Block Operation"></a>Block Operation</h3><p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232144564.png" alt="22"></p>
<p>Block Operation是由一系列的Stripe Operation组成，**<u>次数为（Weight Width×Weight Height）</u>**，每次Stripe Operation的部分和结果都被发送到CACC模块进行累加和的计算。</p>
<!--NVDLA文档上写的是16-32 element accumulator，我理解的是可以对16-32路进来的数据进行累加，在一次Block Operation中每路的数据量应该是（Weight Width×Weight Height），每个数据都是Atomic Operation的部分和。-->

<blockquote>
<p>The partial sums from the same block operation are added together per stripe operation in the convolution accumulator.</p>
</blockquote>
<p>累加和的计算公式如下：<br>$$<br>AS_{w,h,k,c}&#x3D;\sum_{r&#x3D;0}^{R-1}\sum_{s&#x3D;0}^{S-1}\sum_{i&#x3D;c}^{min(c+63,C-1)}x_{(w<em>SX-LP+r),(h</em>SY-TP+s),i}*wt_{r,s,i,k}<br>$$<br>在公式中，AS指accumulative sum，其中第一个和第二个求和应该是由CACC模块进行，第三个求和应该是MAC Cell进行。</p>
<h3 id="Channel-Operation"><a href="#Channel-Operation" class="headerlink" title="Channel Operation"></a>Channel Operation</h3><p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232144295.png" alt="23"></p>
<p>每次Block Operation完成64个kernel的运算，Channel Operation是一系列Block Operation的组合，次数共有<code>(C+63)/64</code>，完成Channel方向上的所有运算。**<u>在同一个Channel Operation中的部分和应该以卷积核为单位继续进行累加操作</u>**，在Channel Operation完成后，存储的累加和才是卷积的最终结果，才会从CACC模块中的assembly SRAM卸载到delivery SRAM，送给后续的处理模块。</p>
<!--CACC模块对16-32路进来的数据进行累加，在一次Block Operation中每路的数据量应该是（Weight Width×Weight Height）×[(C+63)/64]，每个数据都是Atomic Operation的部分和。-->

<h3 id="Group-Operation"><a href="#Group-Operation" class="headerlink" title="Group Operation"></a>Group Operation</h3><p><img src="https://cdn.jsdelivr.net/gh/XduDavid/Blog_Img@main/img/202303232144454.png" alt="24"></p>
<p>Group Operation是Channel Operation的组合，需要重复<code>(data_width*data_height)/(16~32)</code>次。在Group Operation后，输出的数据尺寸为<code>W×H×K&#39;</code>，其中K’为一次Kernel Group中Kernel的数量，对于16-bit的数据而言为16个，对于8-bit的数据而言为32个。</p>
<p>Direct Convolution重复<code>kernel_num/(16~32)</code>次Group Operation即可完成卷积运算，每次的feature data都是相同的。</p>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="权重压缩"><a href="#权重压缩" class="headerlink" title="权重压缩"></a>权重压缩</h3><ul>
<li>WMB：Weight Mask Bit，用一位标记来指示权重元素是否为0，1位与1个权重element对应；对于int16和fp16，1位代表2字节权重数据；对于int8，1位代表1个字节的权重数据；WMB始终是128Byte对齐，不足的补0。</li>
<li>WGS：Weight Group Size，压缩后的权重组数据量大小，单位为Byte，位宽为32bit；</li>
</ul>
<h3 id="Multi-Batch-Mode"><a href="#Multi-Batch-Mode" class="headerlink" title="Multi-Batch Mode"></a>Multi-Batch Mode</h3><p>NVDLA支持多批次模式来提高性能并降低带宽，特别是对于全连接层。全连接层的输出是1×1×C的data cube，也就是说FC层中的所有权重只使用一次，就是FC层的一个条带操作内只有一个原子操作，但流水线卷积还需要16个周期来为下一个原子操作加载权重，MAC的效率下降到6.25%。</p>
<p>多批次就是说同时处理多个输入的特征数据立方体，流水线卷积将为一组权重kernel获取多个输入数据立方体，这也改变了原子操作。来自不同输入数据立方体的1×1×64的cube一个一个交错加载以进行原子操作，然后条带操作包含多个批次的原子操作。由于权重在整个Stripe Operation中重复使用，因此可以把权重加载周期隐藏到处理流程中，提高了MAC的使用效率。</p>
<h2 id="END"><a href="#END" class="headerlink" title="END"></a>END</h2><p><a target="_blank" rel="noopener" href="http://nvdla.org/hw/v1/ias/unit_description.html">Reference</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://david-luge.cn">DavidGu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://david-luge.cn/2022/09/29/Proj/NVDLA%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">http://david-luge.cn/2022/09/29/Proj/NVDLA%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://david-luge.cn" target="_blank">大卫的博客园</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Proj/">Proj</a></div><div class="post_share"><div class="social-share" data-image="/img/Page_Cover/NVIDIA_cover.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/HomePage/wechat_pay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/HomePage/wechat_pay.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/HomePage/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/HomePage/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/09/29/IC/Basic/Verilog%E5%90%84%E7%B1%BB%E5%88%86%E9%A2%91%E5%99%A8%E8%AE%BE%E8%AE%A1%E8%AF%A6%E8%A7%A3/"><img class="prev-cover" src="https://picx.zhimg.com/v2-4259bbf8cc3f2fe52caab6ca6a5591d2_r.jpg?source=172ae18b" onerror="onerror=null;src='/img/HomePage/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Verilog各类分频器设计详解</div></div></a></div><div class="next-post pull-right"><a href="/2022/09/29/FPGA/Vivado%E4%B8%ADRTL%E5%B0%81%E8%A3%85IP%E6%B5%81%E7%A8%8B/"><img class="next-cover" src="/img/Page_Cover/xilinx.jpg" onerror="onerror=null;src='/img/HomePage/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Vivado中RTL封装IP流程</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">部分Blog的图片可能裂掉,参考Misc-Git目录下的解决方案</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#NVDLA%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">NVDLA阅读笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Unit-Description"><span class="toc-number">1.1.</span> <span class="toc-text">Unit Description</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#System-Architecture"><span class="toc-number">1.1.1.</span> <span class="toc-text">System Architecture</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DLA-Core-Architecture"><span class="toc-number">1.1.2.</span> <span class="toc-text">DLA Core Architecture</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Convolution-Pipeline"><span class="toc-number">1.1.3.</span> <span class="toc-text">Convolution Pipeline</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CDMA"><span class="toc-number">1.1.4.</span> <span class="toc-text">CDMA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CBUF"><span class="toc-number">1.1.5.</span> <span class="toc-text">CBUF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSC"><span class="toc-number">1.1.6.</span> <span class="toc-text">CSC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CSC-SG"><span class="toc-number">1.1.6.1.</span> <span class="toc-text">CSC_SG</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CSC-DL"><span class="toc-number">1.1.6.2.</span> <span class="toc-text">CSC_DL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CSC-WL"><span class="toc-number">1.1.6.3.</span> <span class="toc-text">CSC_WL</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CMAC"><span class="toc-number">1.1.7.</span> <span class="toc-text">CMAC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CACC"><span class="toc-number">1.1.8.</span> <span class="toc-text">CACC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SDP"><span class="toc-number">1.1.9.</span> <span class="toc-text">SDP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PDP"><span class="toc-number">1.1.10.</span> <span class="toc-text">PDP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CDP"><span class="toc-number">1.1.11.</span> <span class="toc-text">CDP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RUBIK"><span class="toc-number">1.1.12.</span> <span class="toc-text">RUBIK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BDMA"><span class="toc-number">1.1.13.</span> <span class="toc-text">BDMA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MCIF-amp-SRAMIF"><span class="toc-number">1.1.14.</span> <span class="toc-text">MCIF&amp;SRAMIF</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Convolution-in-NVDLA"><span class="toc-number">1.2.</span> <span class="toc-text">Convolution in NVDLA</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Data-Format"><span class="toc-number">1.2.1.</span> <span class="toc-text">Data Format</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Atomic-Operation"><span class="toc-number">1.2.2.</span> <span class="toc-text">Atomic Operation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Stripe-Operation"><span class="toc-number">1.2.3.</span> <span class="toc-text">Stripe Operation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Block-Operation"><span class="toc-number">1.2.4.</span> <span class="toc-text">Block Operation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Channel-Operation"><span class="toc-number">1.2.5.</span> <span class="toc-text">Channel Operation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Group-Operation"><span class="toc-number">1.2.6.</span> <span class="toc-text">Group Operation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E5%AE%83"><span class="toc-number">1.3.</span> <span class="toc-text">其它</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%87%8D%E5%8E%8B%E7%BC%A9"><span class="toc-number">1.3.1.</span> <span class="toc-text">权重压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Multi-Batch-Mode"><span class="toc-number">1.3.2.</span> <span class="toc-text">Multi-Batch Mode</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#END"><span class="toc-number">1.4.</span> <span class="toc-text">END</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/04/15/IC/AXI/AXI%E5%8D%8F%E8%AE%AE/" title="AXI协议概述"><img src="/img/Page_Cover/AXI.png" onerror="this.onerror=null;this.src='/img/HomePage/404.jpg'" alt="AXI协议概述"/></a><div class="content"><a class="title" href="/2024/04/15/IC/AXI/AXI%E5%8D%8F%E8%AE%AE/" title="AXI协议概述">AXI协议概述</a><time datetime="2024-04-15T13:39:39.000Z" title="发表于 2024-04-15 21:39:39">2024-04-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/15/IC/AXI/AXI4%E4%B8%8EAXI3%E7%9A%84%E5%8C%BA%E5%88%AB/" title="AXI4与AXI3的区别"><img src="/img/Page_Cover/AXI.png" onerror="this.onerror=null;this.src='/img/HomePage/404.jpg'" alt="AXI4与AXI3的区别"/></a><div class="content"><a class="title" href="/2024/04/15/IC/AXI/AXI4%E4%B8%8EAXI3%E7%9A%84%E5%8C%BA%E5%88%AB/" title="AXI4与AXI3的区别">AXI4与AXI3的区别</a><time datetime="2024-04-15T03:39:39.000Z" title="发表于 2024-04-15 11:39:39">2024-04-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/13/IC/EDA/Verilog-Mode%E5%85%A5%E9%97%A8/" title="Verilog-Mode入门"><img src="https://picx.zhimg.com/v2-4259bbf8cc3f2fe52caab6ca6a5591d2_r.jpg?source=172ae18b" onerror="this.onerror=null;this.src='/img/HomePage/404.jpg'" alt="Verilog-Mode入门"/></a><div class="content"><a class="title" href="/2024/04/13/IC/EDA/Verilog-Mode%E5%85%A5%E9%97%A8/" title="Verilog-Mode入门">Verilog-Mode入门</a><time datetime="2024-04-13T13:10:39.000Z" title="发表于 2024-04-13 21:10:39">2024-04-13</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2024  DavidGu <a href="/love/"><i id="heartbeat" class="fa fas fa-heartbeat"></i></a> LugeWang</div><div class="footer_custom_text">欢迎来到大卫的博客园!</div></div><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></head></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '4fFz2tMISVCxeHM6f7dDL8hc-gzGzoHsz',
      appKey: '1KNfIKxigPxTCWkGvMnFysl7',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fishes.js"></script><script type="text/javascript" src="\js\FunnyTitle.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>